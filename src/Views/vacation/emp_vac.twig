{% extends "master.twig" %}


{% block style %}
	<style>


		.scrollable-div {
			height: 700px; /* Set the desired height */
			overflow: auto; /* Enable scrolling */
		}
	</style>
{% endblock %}


{% block main %}


	<main class="col ms-1">
		<div class="card">
			<div class="card-header p-3">
				<h5>اجازات الموظف</h5>
			</div>


			<div class="card-body ">


				<div x-data="dataTable()">
					<div class="table-responsive">
						<div class="mb-3">
							<input type="text" id="search" x-model="searchTerm" class="form-control" placeholder="ابحث ... "/>						
						</div>

						<table class="table table-striped  table-hover align-middle">
							<thead>
								<tr>
									<th class="text-center fit">نوع الاجازة</th>
									<th class="text-center fit">من تاريخ</th>
									<th class="text-center fit">الى تاريخ</th>
									<th class="text-center fit">عدد الأيام</th>
									<th class="text-center fit">حالة الاجازة</th>
									<th class="text-center fit">مدخل الاجازة</th>
									<th class="text-center fit">تاريخ الادخال</th>
									<th class="text-center fit">الاجراءات</th>
								</tr>
							
							</thead>
							<tbody class="table-group-divider">

								<template x-for="(row, index) in filteredRows" :key="index">
									<tr>
										
										<td class="text-center fit  d-none" x-text="row.employee_id"></td>

										<td class="text-center fit" x-text="row.vacation_name"></td>
										<td  class="text-center fit"x-text="row.start_date"></td>
										<td  class="text-center fit"x-text="row.end_date"></td>
										<td  class="text-center fit"x-text="row.day_count"></td>
										<td  class="text-center fit"x-html="row.vacation_status"></td>
										<td  class="text-center fit"x-text="row.create_user"></td>
										<td  class="text-center fit"x-text="row.create_date"></td>

										<td class="text-center align-middle ">
											
											<button type="button" class="btn btn-outline-info btn-sm" data-bs-toggle="tooltip" data-bs-placement="top"  data-bs-title="بيانات الاجازة">
												<i class="bi bi-search fs-5"></i>
											</button>

											<button  type="button" x-on:click="getEmpBalance($event.target, row, row.employeeName)"
												class="btn btn-outline-warning btn-sm" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="تعديل الاجازة">
												<i class="bi-pencil-square fs-5"></i>
											</button>
											
											<button  type="button" x-on:click="getEmpBalance($event.target, row, row.employeeName)"
												class="btn btn-outline-primary btn-sm" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="موافقة/رفض">
												<i class="bi bi-toggles fs-5"></i>
											</button>

											<button type="button" class="btn btn-outline-danger btn-sm" x-on:click="($event.target, row)" data-bs-toggle="tooltip" data-bs-title="إالغاء الاجازة">
												<i class="bi bi-trash fs-5"></i>
											</button>

											<!-- Modal -->
											<div class="modal fade" id="GetEmpBalanceModal" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
												<div class="modal-dialog modal-dialog-scrollable">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title fs-5" id="empName"></h5>
															<div class="d-flex flex-row-reverse mb-3 ">
																<button type="button" class="btn-close " data-bs-dismiss="modal" aria-label="Close"></button>
															</div>
														</div>
														<div class="modal-body">
															<table class="table table-striped" id="empBalTable">
																<thead>
																	<tr>
																		<th scope="col">نوع الاجازة</th>
																		<th scope="col">رصيد بداية المدة</th>
																		<th scope="col">الرصيد الحالي</th>
																	</tr>
																</thead>
																<tbody></tbody>

															</table>
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
														</div>
													</div>
												</div>
											</div>


							
										</td>

									</tr>

								</template>
							</tbody>
						</table>
					</div>
				</div>
				
			</div>
		</div>


<script>
  const dataTable = () => {
    return {
      table: null,
      options: {
        searching: false,
        ordering: true,
        paging: true,
        lengthChange: true,
        info: true,
        autoWidth: true
      },
	  
	  employee_id:'',
	  vacation_name: '', 
      start_date: '',
	  end_date:'',
	  day_count: '',
	  vacation_status: '', 
      create_user: '',
	  create_date:'',
  	  searchTerm: '',     

    
      rows: [{% for item in vacation_list %}{
		employee_id: '{{ item.employee_id }}',
		vacation_name: '{{ item.vacation_name ~ item.separator ~ lookups.annual_vacation_type[item.annual_vac_type]}}',
        start_date: '{{ item.start_date|date("d/m/Y") }}',
		end_date: '{{ item.end_date|date("d/m/Y") }}',
		day_count: '{{ (date(item.end_date).diff(date(item.start_date))).days + 1 }}',
		vacation_status: '<i class = "{{ lookups.status_class[item.vacation_status] }}" ></i> {{ lookups.vacation_status[item.vacation_status] }}',
        create_user: '{{ item.en_name}}',
		create_date: '{{ item.create_date|date("H:i:s  d/m/Y") }}',
              
      },
      {% endfor %}],

      get filteredRows() {
        if (!this.searchTerm) {
          return this.rows;
        }
		
		const term = this.searchTerm.toLowerCase();

        return this.rows.filter(row => {

          return row.employee_id.toLowerCase().includes(term) || row.vacation_name.toLowerCase().includes(term) 
		  		|| row.start_date.toLowerCase().includes(term) || row.end_date.toLowerCase().includes(term) 
		  		|| row.vacation_status.toLowerCase().includes(term) || row.create_user.toLowerCase().includes(term)
				|| row.create_date.toLowerCase().includes(term);

        });
      }
    };
  };
</script>



</main>
{% endblock %}
{% block script %}

{% endblock %}
