{% extends "master.twig" %}

{% block style %}{% endblock %}

{% block main %}

<form action="/job_assignment/storecustomize/{{data[0].id}}" method="post">

	{{ csrf.fields | raw }}
		<div class="row" >
			<div class="col-12 col-md-12 col-xxl-12 d-flex">
				<div class="card flex-fill ">
	                <div class="card-header row justify-content-between  p-3 border-bottom">
                        <div class="col-md-6">
                            <h4 class="text-end me-3 mt-3"> توجيه مهمة العمل الخارجيه
                            </h4>
                        </div>
                        <div class="col-md-6">
                            <nav class="nav justify-content-end p-3">
                                <a href="/job_assignment/list" type="button" class="btn btn-primary">
                                    <i class="bi bi-plus-circle-dotted"></i>
                                    جميع المهمات
                                </a>
                            </nav>
                        </div>
			        </div>
					
					<div class="card-body" >	

						<div class="row justify-content-md-center">
                          <div class="col-8 col-md-3 col-xxl-8">
                             <div class="row mb-2">                                    
                                    <div class="col-4">
                                        <div class="form-floating mb-4">
                                            <input type="text" value="{{ lookups.job_assignment_type[data[0].mission_type] }}" id="mission_type" name="mission_type" class="form-control " placeholder=" نوع المهمه" aria-label=".form-select-sm example" >                                     
                                            <label for="mission_start_date">نوع المهمه</label>
                                        </div>                                            
                                    </div>
 <input type="hidden" value="{{data[0].id}}" id="id" name="id"  >
                                    <div class="col-4">
                                        <div class="form-floating mb-4">
                                            <input type="text" value="{{ lookups.job_assignment_supject[data[0].mission_supject] }}" id="mission_supject" name="mission_supject" class="form-control" placeholder=" موضوع المهمه" >
                                                                                      
                                            <label for="mission_end_date">موضوع المهمه<label>
                                        </div>
                                    </div>     
                                </div>
                                <div class="row mb-2">                                    
                                    <div class="col-4">
                                        <div class="form-floating mb-4">
                                            <input type="text" value="{{ lookups.country[data[0].mission_country] }}" id="mission_country" name="mission_country" class="form-control " placeholder="  الدوله" aria-label=".form-select-sm example" >                                     
                                            <label for="mission_start_date">الدولة </label>
                                        </div>                                            
                                    </div>

                                    <div class="col-4">
                                        <div class="form-floating mb-4">
                                            <input type="text" value="{{ lookups.hosting_type[data[0].hosted_type] }}" id="hosted_type" name="hosted_type" class="form-control" placeholder=" نوع الاستضافه" >
                                                                                      
                                            <label for="mission_end_date">نوع الاستضافه<label>
                                        </div>
                                    </div>     
                                </div>
                            <div class="row mb-3">
                                <div class="col-4">
                                        <div class="form-floating mb-4">
                                            <input type="date" value="{{ data[0].mission_start_date }}" id="mission_start_date" name="mission_start_date" class="form-control {{ errors.mission_start_date ? 'is-invalid' : '' }}" placeholder="من تاريخ" aria-label=".form-select-sm example" onblur ="days()">                                            

                                            <div class="invalid-feedback">
                                                {{ errors.mission_start_date | first }}
                                            </div>

                                            <div id="invalid-dates" class="invalid-feedback" ></div>   
                                            
                                            <label for="mission_start_date">من تاريخ</label>
                                        </div>                                            
                                    </div>

                                    <div class="col-4">
                                        <div class="form-floating mb-4">
                                            <input type="date" value="{{ data[0].mission_end_date }}" id="mission_end_date" name="mission_end_date" class="form-control {{ errors.mission_end_date ? 'is-invalid' : '' }}" placeholder="إلى تاريخ" aria-label="إلى تاريخ"  onblur ="days()">
                                            
                                            <div class="invalid-feedback">
                                                {{ errors.mission_end_date | first }}
                                            </div>
                                            
                                            <label for="mission_end_date">إلى تاريخ<label>
                                        </div>
                                    </div>                                
                                   

                                
                                <div class="col-4">
                                    <div class="form-floating mb-4">                                                                     
                                        <input type="text" style="background-color:#edf2f9" value="{{ data[0].day_count }}" id="day_count" name="day_count" class="form-control" placeholder="عدد الايام" aria-label="عدد الايام" readonly>
                                        <label for="floatingInput">عدد ايام المهمه<label>
                                    </div>
                                </div> 
                            </div>  
                            <div class="row mb-2">                                    
                                    <div class="col-4">
                                        <div class="form-floating mb-4">
                                            <input type="text" value="{{ data[0].mission_funded }}" id="mission_funded" name="mission_funded" class="form-control " placeholder="  الجهه المموله" aria-label=".form-select-sm example" >                                     
                                            <label for="mission_start_date">الجهه المموله </label>
                                        </div>                                            
                                    </div>

                                    <div class="col-4">
                                        <div class="form-floating mb-4">
                                            <input type="text" value="{{ data[0].last_date }}" id="last_date" name="last_date" class="form-control" placeholder="اخر تاريخ لترشح" >
                                                                                      
                                            <label for="mission_end_date">اخر تاريخ لترشيح <label>
                                        </div>
                                    </div>     
                                </div> 
                                <div  class="row mb-2">
                                    <div class="col-4">                                                                     
                                        <textarea  id="short_description" name="short_description"   class="form-control" placeholder="وصف مختصر" aria-label="وصف مختصر" rows="4">{{ data[0].short_description }}</textarea>
                                        <label for="floatingInput">وصف مختصر<label>
                                    </div>
                                     <div class="col-4">                                                                     
                                        <textarea  id="note" name="note"   class="form-control" placeholder=" ملاحظات" aria-label="ملاحظات " rows="4">{{ data[0].note }}</textarea>
                                        <label for="floatingInput"> ملاحظات<label>
                                    </div>
                                   
                                </div>  
                                <div  class="row mb-2">
                                    <table class="table">
  <thead>
    <tr>
    <th class="text-center fit">رقم</th>
      <th class="text-center fit">الادارة</th>
      
      <th class="text-center fit" >ترشيح</th>
      <th class="text-center fit">عدد المرشحين</th>
    </tr>
  </thead>
  <tbody>
   {% set counter = 1 %}
  {% for key, vac in dept %}
 
    <tr>
      <td class="text-center fit" >{{ counter }}</td>
     <input type="hidden" value="{{vac.dept_id}}" id="dept_id_{{vac.dept_id}}" name="dept_id_{{vac.dept_id}}"  >
      <td class="text-center fit" >{{ vac.name }}</td>
      <td><input  type="checkbox" value="1" id="check_{{vac.dept_id}}" name="check_{{vac.dept_id}}" onclick="handleClick(this)"/></td>
       <td><input type="text" value="" id="emp_coun_{{vac.dept_id}}" name="emp_coun_{{vac.dept_id}}"  ></td>
      
    </tr>
{% set counter = counter + 1 %}
    {% endfor %}
  </tbody>
</table>
                                   
                                </div>  
                        <div class="d-flex justify-content-center d-grid gap-2">
							<button type="submit" class="btn btn-outline-primary">حفظ </button>
                            
						</div>                          
                           </div>
                            
						</div>
                        
					</div>
				</div>
			</div>
		</div>
	

	</form>



<script>
function handleClick(cb) {
  cb.value = cb.checked ? 1 : 0;
  
  
}

  function days() {

    let mission_start_date = document.getElementById("mission_start_date").value;
    let mission_end_date = document.getElementById("mission_end_date").value;
   
    let day_count = 0;
  //document.getElementById("day_count").value =(mission_start_date);
        
        let date1 = Date.parse (mission_start_date);
        let date2 = new Date (mission_end_date);
        let now = new Date();

        document.getElementById("day_count").value = '';
        document.getElementById("invalid-dates").style.display = 'none';
      //  if(mission_start_date.length !== 0 && mission_end_date.length !== 0 ){


            
                document.getElementById("day_count").value = '';
                day_count = (Math.round((date2 - date1) / (1000 * 60 * 60 * 24))) + 1 ;

                        if (day_count > 0) {

                            document.getElementById("day_count").value = day_count;
                            }
                
                if (day_count <= 0){
                    document.getElementById("invalid-dates").style.display = 'block';
                    document.getElementById("invalid-dates").innerHTML = 'خطأ في ادخال التواريخ';

                }
            
       // }
  }

  window.onload =days()
  </script>

{% endblock %}
