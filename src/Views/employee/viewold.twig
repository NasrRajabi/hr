{% extends "master.twig" %}

{% block style %}

	<style>

		.employee-card {

			position: relative;
		}


		.social-link {
			width: 30px;
			height: 30px;
			border: 1px solid #ddd;
			display: flex;
			align-items: center;
			justify-content: center;
			color: #666;
			border-radius: 50%;
			transition: all 0.3s;
			font-size: 0.9rem;
		}

		.social-link:hover,
		.social-link:focus {
			background: #ddd;
			text-decoration: none;
			color: #555;
		}
	</style>
	{{ parent() }}
{% endblock %}

{% block main %}
	<div class="container-fluid">
		<div class="card">
			<div class="card-header p-3">
				<h3>لائحة الموظفين
				</h3>
			</div>


			<div
				class="d-flex justify-content-end my-3" aria-label="View Toggle">

				{# <input type="search" class="form-control" > #}

				<button onclick="showTable()" class="btn btn-light mx-2">
					<i class="bi bi-list "></i>
				</button>
				<button onclick="showGrid()" class="btn btn-light">
					<i class="bi bi-grid-3x3-gap-fill"></i>
				</button>
				<button "" class="btn btn-primary mx-2">
					<i class="bi bi-person-plus-fill"></i>
					اضافة موظف
				</button>

			</div>
			<div class="col-md-12">


				<div class="d-flex justify-content-start my-3">
				<input type="search" class="form-control"> 
							
			</div>
<div class="m-4">
{% for dev in data %}


<div class="accordion" id="accordionExample{{ dev.dept_id }}">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne{{ dev.dept_id }}">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne{{ dev.dept_id }}" aria-expanded="true" aria-controls="collapseOne{{ dev.dept_id }}">
          {{ dev.dept_name }}          
      </button>
     									
            </h2>
           <div id="collapseOne{{ dev.dept_id }}" class="accordion-collapse collapse " aria-labelledby="headingOne{{ dev.dept_id }}" data-bs-parent="#accordionExample{{ dev.dept_id }}">
      <div class="accordion-body">
                    	<div id="tableData" class="d-block mt-5">
						<div class="row">
							
								<div x-data="data()">
									<table class="table table-striped table-hover ">
										<thead>
											<tr>
												<th></th>

												<th @click="sortByColumn" class="cursor-pointer select-none">
													<i class="bi bi-arrow-down-up"></i>
													الاسم</th>
												<th @click="sortByColumn" class="cursor-pointer select-none">
													<i class="bi bi-arrow-down-up"></i>
													الرقم الوظيفي</th>
												<th @click="sortByColumn" class="cursor-pointer select-none">
													<i class="bi bi-arrow-down-up"></i>
													المحمول</th>
												<th @click="sortByColumn" class="cursor-pointer select-none">
													<i class="bi bi-arrow-down-up"></i>
													البريد الالكتروني</th>
												<th @click="sortByColumn" class="cursor-pointer select-none">
													<i class="bi bi-arrow-down-up"></i>
													التكليف
												</th>
												<th @click="sortByColumn" class="cursor-pointer select-none">
													<i class="bi bi-arrow-down-up"></i>
													تاريخ مباشرة العمل
												</th>

											</tr>
										</thead>
										<tbody x-ref="tbody">

						
							{% for item in data %}
							{% if (dev.dept_id == item.dept_id )%}
											<tr>
												<td class="align-middle">
													<i class="bi bi-three-dots-vertical " id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false"></i>
													<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
														<a class="dropdown-item" href="/employee/profile/{{item.id}}">مشاهدة الملف</a>
														<a class="dropdown-item" href="#">تعديل</a>
													</div>
												</td>
									
												<td>
													<div class="d-flex flex-row float-end">
														<div class="ms-3"><img src="{{ item.avatar }}" alt="" width="55" class="rounded-circle  img-thumbnail "></div>
														<div class="p-2">
															<h6 class="mb-0 text-primary fw-bold">
															{{ item.f_name ~ ' ' ~ item.s_name ~ ' ' ~ item.t_name ~ ' ' ~ item.l_name }}

								</h6>
															<span class="small text-uppercase text-muted">{{ lookups.job_title[item.job_title] }}</span>2</div>
													</div>

												</td>
												<td class="text-right align-middle">{{ item.employee_no }}</td>
												<td class="text-right align-middle">{{item.g_mobile}}</td>
												<td class="text-right align-middle">{{item.g_email}}</td>
												<td class="text-right align-middle"></td>
												<td class="text-right align-middle">{{item.job_start_date}}</td>
											</tr>

							{%  endif %}
							{%  endfor %}
						
						
											<!-- Add more employee data rows here -->
										</tbody>
									</table>

								</div>
					</div>
                </div>
            </div>
        </div>
       
        
    </div>


{%  endfor %}
</div>
				
				</div>
			</div>

			<div id="gridData" class="d-none">

				<div class="container mt-3">
					<div class="row text-center">
						{% for item in data %}
							<!-- Team item -->
							<div class="col-xl-3 col-sm-6 mb-5">
								<div class="employee-card position-relative">


									<i class="bi bi-three-dots-vertical position-absolute top-0 end-0" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false"></i>
									<div class="dropdown-menu text-body-secondary text-end" aria-labelledby="dropdownMenuButton">
										<a class="dropdown-item" href="/employee/profile/{{item.id}}">
											<i class="bi bi-eye-fill"></i>
											مشاهدة الملف
										</a>
										<a class="dropdown-item" href="#">
											<i class="bi bi-pencil-square"></i>
											تعديل</a>
									</div>

									<div class="bg-body-tertiary rounded shadow-sm py-5 px-4">
										<img src="{{ item.avatar }}" alt="" width="100" class="img-fluid rounded-circle mb-3 img-thumbnail shadow-sm">
										<h5 class="mb-0">
											{{ item.f_name ~ ' ' ~ item.s_name ~ ' ' ~ item.t_name ~ ' ' ~ item.l_name }}</h5>
										<span class="small text-uppercase text-muted">{{ lookups.job_title[item.job_title] }}</span>
									</div>
								</div>
							</div>
							<!-- End -->

						{% endfor %}


					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
		function showTable() {
var tableData = document.getElementById("tableData");
var gridData = document.getElementById("gridData");
tableData.classList.remove("d-none");
gridData.classList.add("d-none");
}

function showGrid() {
var tableData = document.getElementById("tableData");
var gridData = document.getElementById("gridData");
tableData.classList.add("d-none");
gridData.classList.remove("d-none");
}


function data() {
return {
sortBy: "",
sortAsc: false,
sortByColumn($event) {
if (this.sortBy === $event.target.innerText) {
if (this.sortAsc) {
this.sortBy = "";
this.sortAsc = false;
} else {
this.sortAsc = !this.sortAsc;
}
} else {
this.sortBy = $event.target.innerText;
}

let rows = this.getTableRows().sort(this.sortCallback(Array.from($event.target.parentNode.children).indexOf($event.target))).forEach((tr) => {
this.$refs.tbody.appendChild(tr);
});
},
getTableRows() {
return Array.from(this.$refs.tbody.querySelectorAll("tr"));
},
getCellValue(row, index) {
return row.children[index].innerText;
},
sortCallback(index) {
return(a, b) => ((row1, row2) => {
return row1 !== "" && row2 !== "" && !isNaN(row1) && !isNaN(row2) ? row1 - row2 : row1.toString().localeCompare(row2);
})(this.getCellValue(this.sortAsc ? a : b, index), this.getCellValue(this.sortAsc ? b : a, index));
}
};
}
	</script>
{% endblock %}
